global:
  deploymentMode: oss

# INTERNAL chart Postgres (enabled)
postgresql:
  enabled: true

# INTERNAL chart MinIO (disabled) â€” we use OpenKPI MinIO
minio:
  enabled: false

webapp:
  ingress:
    enabled: false

# ---- Storage wiring to OpenKPI MinIO (S3-compatible) ----
server:
  extraEnvFrom:
    - configMapRef:
        name: airbyte-s3-config
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_USER"
          optional: false
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_PASSWORD"
          optional: false
    - name: S3_PATH_STYLE_ACCESS
      value: "true"

worker:
  extraEnvFrom:
    - configMapRef:
        name: airbyte-s3-config
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_USER"
          optional: false
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_PASSWORD"
          optional: false
    - name: S3_PATH_STYLE_ACCESS
      value: "true"

workloadLauncher:
  extraEnvFrom:
    - configMapRef:
        name: airbyte-s3-config
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_USER"
          optional: false
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_PASSWORD"
          optional: false
    - name: S3_PATH_STYLE_ACCESS
      value: "true"

workloadApiServer:
  extraEnvFrom:
    - configMapRef:
        name: airbyte-s3-config
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_USER"
          optional: false
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: "openkpi-minio-secret"
          key: "MINIO_ROOT_PASSWORD"
          optional: false
    - name: S3_PATH_STYLE_ACCESS
      value: "true"
